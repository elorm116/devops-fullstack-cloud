services:
# ---- BACKEND SERVICE ----
  app:
    build:
      context: ./api
      target: development
    image: myjs-app:dev
    container_name: api_container
    ports:
      - "4000:4000"
    restart: unless-stopped
    volumes:
      - ./api:/app
      - /app/node_modules 
    environment:
      - NODE_ENV=development
      - PORT=4000
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:4000/health"]
      interval: 10s
      timeout: 3s
      retries: 5
      start_period: 10s
    command: npm run dev

# ---- FRONTEND SERVICE ----
  myblog:
    build:
      context: ./myblog
      target: development
    image: myblog-app:dev
    container_name: myblog_container
    ports:
      - "3000:3000"
    restart: unless-stopped
    stdin_open: true
    tty: true
    volumes:
      - ./myblog:/app
      - /app/node_modules
    environment:
      - NODE_ENV=development
      - REACT_APP_API_URL=http://localhost:4000/
    depends_on:
      app:
        condition: service_healthy
    command: npm start